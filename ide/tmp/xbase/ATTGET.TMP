.* ----------------------------------------------------------------------------
.* TEMPLATE     : ATTGET.tmp
.* RELEASE      : 4.0
.* VERSION      : d
.* DESCRIZIONE  : Aggiunge control ENTRY FIELD ad oggetto.
.* ----------------------------------------------------------------------------
.M->cTcnd    := tItmActive()
.M->cTwvc    := ".T."
.M->cTipAlign:= ""
.if tUdfGet( cTnSeek ,aTukLast )
   .M->cTwvc  := iif( toItem("editcondition")=="1" ,cTsym+"(ab)" ,".F." )
.endif
.M->nTpfkItm := 0
.oo_mnu->(dbSetOrder(1))
.if oo_mnu->(dbSeek(oo_itm->OBJ+oo_itm->ITM+oo_itm->IGC))
.do pfkitm
.endif
.if oo_itm->TYP == "txb"
   .M->cTsys  := iif(empty(toItem('getfunction')),'""',["]+toItem('getfunction')+["])
   .M->cTc    := ["]+tItmCol("promptcolor") +[","]+tItmCol("hotkeycolor")     +[","]+;
                     tItmCol("datacolor")   +[","]+tItmCol("datahilitecolor") +[","]+;
                     tItmCol("topleftcolor")+[","]+tItmCol("bottomrightcolor")+["]
   .M->cXTc := ""
   .if empty(toItem("xbpromptcolor")) .and. empty(toItem("xbdatacolor"))
      .M->cXTc := "{"+cTc+"}"
   .else
      .if empty(toItem("xbpromptcolor"))
         .M->cXTc := ["]+tItmCol("promptcolor") +[",NIL,"]
      .else
         .M->cXTc := ["]+toItem("xbpromptcolor") +[",NIL,"]
      .endif
      .if empty(toItem("xbdatacolor"))
         .M->cXTc := cXTc+tItmCol("datacolor") +[",NIL,NIL,NIL]
      .else
         .M->cXTc := cXTc+toItem("xbdatacolor") +[",NIL,NIL,NIL]
      .endif
      .M->cXTc := 'DFXPPCLRSELECT({'+cXTc+'},{'+cTc+'})'
   .endif
   .M->cFont  := toItem("fontname")
   .M->cPFont := toItem("promptfontname")
   .if ! empty(cFont) .and. at("(", cFont) == 0
       .M->cFont := ["]+cFont+["]
   .endif
   .if ! empty(cPFont) .and. at("(", cPFont) == 0
       .M->cPFont := ["]+cPFont+["]
   .endif
ATTACH "ÛcIdC+'" TO oWin:W_CONTROL GET AS TEXTFIELD '+cTsym+' AT '+nTr1+','+nTc1+','+nTr2+','+nTc2Û ð ; // ATTGET.TMP
.if type("OS()")=="C"    
.* Visual dBsee
                 COORDINATE  W_COORDINATE_PIXEL ; // Coordinate in Formato Pixel
   .if !EMPTY(toItem("xball_vert")) .OR. !EMPTY(toItem("xball_oriz"))
      .M->cTipAlign := tAlign(toItem("xball_oriz"), toItem("xball_vert"))
                 ALIGNMENT ÛM->cTipAlignÛ    ð ; // TEXTFIELD ALIGNMENT
   .endif
.endif
.if !(cTpag=="1")
                 PAGE        ÛcTpagÛ  ð ; // Pagina
.endif
                 COLOR ÛcXTcÛ            ð ; // Array dei colori
                 CONDITION {|ab|ÛcTwvcÛ} ð ; // Funzione When/Valid
                 SYSFUNCTION ÛcTsysÛ  ð ; // Funzione di sys
                 MESSAGE ÛtExpCast(cTmsg)Û ð ; // Messaggio
                 VARNAME "ÛcTSymÛ" ð ; //
   .if !Empty(cTrefId)
                 REFRESHID "ÛcTrefIdÛ" ð ; // Appartiene ai gruppi di refresh
   .endif
   .if !Empty(cTrefGr)
                 REFRESHGRP "ÛcTrefGrÛ" ð ; // Esegue il gruppo di refresh
   .endif
   .if toItem("memoinkey")=="1"
                 NOINKEY              ð ; // Edit memo senza tasto
   .endif
   .if !Empty(cTpro)
                 PROMPT ÛtExpCast(cTpro)Û ð ; // Prompt
   .endif
                 BOX   Ûoo_itm->FONTÛ ð ; // Tipo Box
   .if nTpfkItm > 0
                 PFK aPfkItm          ð ; // Array dei tasti della get
   .endif
   .if !Empty(toItem("memowidth"))
                 MEMOWIDTH ÛtoItem("memowidth")Û ð ; // Larghezza testo del memo
   .endif
   .if !(cTdis=="{||.T.}")
                 DISPLAYIF ÛcTdisÛ    ð ; // Display condizionale
   .endif
   .if !Empty(cFont)
                 FONT       ÛcFontÛ ð ; // Font Name (XBASE)
   .endif
   .if !Empty(cTpro) .and. !Empty(cPFont)
                 PROMPTFONT ÛcPFontÛ ð ; // Prompt Font Name (XBASE)
   .endif
                 ACTIVE   {||cState $ "ÛcTcndÛ" } ð   // Stato di attivazione
.else
   .M->cTc    := ["]+tItmCol("promptcolor")+[","]+tItmCol("hotkeycolor")      +[","]+;
                     tItmCol("datacolor")  +[","]+tItmCol("datahilitecolor")  +["]
   .M->cXTc := ""
   .if empty(toItem("xbpromptcolor")) .and. empty(toItem("xbdatacolor"))
      .M->cXTc := "{"+cTc+"}"
   .else
      .if empty(toItem("xbpromptcolor"))
         .M->cXTc := ["]+tItmCol("promptcolor") +[",NIL,"]
      .else
         .M->cXTc := ["]+toItem("xbpromptcolor") +[",NIL,"]
      .endif
      .if empty(toItem("xbdatacolor"))
         .M->cXTc := cXTc+tItmCol("datacolor") +[",NIL]
      .else
         .M->cXTc := cXTc+toItem("xbdatacolor") +[",NIL]
      .endif
      .M->cXTc := 'DFXPPCLRSELECT({'+cXTc+'},{'+cTc+'})'
   .endif
   .M->cFont  := toItem("fontname")
   .M->cPFont := toItem("promptfontname")
   .if ! empty(cFont) .and. at("(", cFont) == 0
       .M->cFont := ["]+cFont+["]
   .endif
   .if ! empty(cPFont) .and. at("(", cPFont) == 0
       .M->cPFont := ["]+cPFont+["]
   .endif                                                          
   .m->cTChecks:= ""
   .m->lTMandItm := .F.
   .dd_sym->(dfPushArea())
   .dd_sym->( dbSetOrder( 1 ) )
   .dd_sym->( dbSeek( oo_itm->ITMGET ) )
   .if toItem("mandatoryitm")=="1"
      .m->lTMandItm := .T.
   .else
      .if toItem("mandatoryitm")!="2" .AND. toSymbol("mandatory") == "1"
          .m->lTMandItm := .T.
      .endif
   .endif
   .if ! lTMandItm
      .if tItmLkUpGet( oo_itm->ITMGET, if(oo_itm->TYP=="get", oo_obj->DBF, oo_itm->ALS ))
          .if toRelation("lookupmode")=="1"
              .m->lTMandItm := .T.
          .endif
      .endif
   .endif
   .if ! lTMandItm
      .if tItmPrimaryKey( cTnSeek ,dd_sym->SYM ) != -1
          .m->lTMandItm := .T.
      .endif
   .endif
   .if lTmandItm
      .m->cTChecks:= IIF(EMPTY(cTChecks), "", cTChecks+"+")+"GET_CHK_MANDATORY"
   .endif
   .if ! Empty( toSymbol("validation") )
      .m->cTChecks:= IIF(EMPTY(cTChecks), "", cTChecks+"+")+"GET_CHK_VALIDATION"
   .endif
   .dd_sym->(dfPopArea())
ATTACH "ÛcIdC+'" TO oWin:W_CONTROL GET '+cTsym+' AT '+nTr1+','+nTc1Û ð ; // ATTGET.TMP
.if type("OS()")=="C"    
.* Visual dBsee
                 SIZE       {ÛnTc2Û,ÛnTr2Û} ð ; // Dimensioni Campo get
                 COORDINATE  W_COORDINATE_PIXEL ð ; // Coordinate in Pixel
   .if !EMPTY(toItem("xbget_oriz"))
      .M->cTipAlign := tAlign(toItem("xbget_oriz"))
                 ALIGNMENT ÛM->cTipAlignÛ    ð ; // GET ALIGNMENT
   .endif
.endif
   .if !(cTpag=="1")
                 PAGE        ÛcTpagÛ   ð ; // Pagina
   .endif
                 COLOR  ÛcXTcÛ         ð ; // Array dei colori
   .if !Empty(cTpro)
       .cTproAt := Str(tPromptRow(),4)+" ,"+Str(tPromptCol(),4)
                 PROMPT   ÛtExpCast(cTpro)Û ð ; // Prompt
                 PROMPTAT ÛcTproAtÛ   ð ; // Coordinate prompt
   .endif
   .if !(cTpicG==cTpicS)
                 PICTUREGET "ÛcTpicGÛ" ð ; // Picture in get
   .endif
                 PICTURESAY "ÛcTpicSÛ" ð ; // Picture in say
   .if !(cTwvc==".T.")
                 CONDITION {|ab|ÛcTwvcÛ} ð ; // Funzione When/Valid
   .endif
   .if !(cTsys=="{|oGet|.T.}")
                 SYSFUNCTION ÛcTsysÛ  ð ; // Funzione interna alla get
   .endif
   .if !Empty(cTmsg)
                 MESSAGE ÛtExpCast(cTmsg)Û ð ; // Messaggio
   .endif
                 VARNAME "ÛcTSymÛ" ð ; //
   .if !Empty(cTrefId)
                 REFRESHID "ÛcTrefIdÛ" ð ; // Appartiene ai gruppi di refresh
   .endif
   .if !Empty(cTrefGr)
                 REFRESHGRP "ÛcTrefGrÛ" ð ; // Esegue il gruppo di refresh
   .endif
   .M->cTpreEx := toitem("precomputedexp")
   .if !Empty(cTpreEx)
                 COMPUTEDEXP {||ÛTRIM(cTsym)+[:=]+cTpreExÛ} ð ; // Espressione di ricalcolo
   .endif
   .M->cTpreGr := toitem("precomputedid")
   .if !Empty(cTpreGr)
                 COMPUTEDGRP "ÛcTpreGrÛ" ð ; // ID che comandano il ricalcolo
   .endif
   .if (toItem("editcondition")=="1").AND.tItmLkUpGet(oo_itm->ITMGET,if(oo_itm->TYP=="get", oo_obj->DBF, oo_itm->ALS))
                 COMBO                ð ; // Icona combo
       .if toItem("controlgap")=="1"
                 GAP   1              ð ; // Spaziatura icona control/dati
       .endif
   .endif
   .if nTpfkItm > 0
                 PFK aPfkItm          ð ; // Array dei tasti della get
   .endif
   .if !(cTdis=="{||.T.}")
                 DISPLAYIF ÛcTdisÛ    ð ; // Display condizionale
   .endif
   .if !Empty(cTChecks)
                 CHECKS    ÛcTChecksÛ ð ; // Checks
   .endif
   .if !Empty(cFont)
                 FONT       ÛcFontÛ ð ; // Font Name (XBASE)
   .endif
   .if !Empty(cTpro) .and. !Empty(cPFont)
                 PROMPTFONT ÛcPFontÛ ð ; // Prompt Font Name (XBASE)
   .endif
                 ACTIVE {||cState $ "ÛcTcndÛ" } ð  // Stato di attivazione
.endif
